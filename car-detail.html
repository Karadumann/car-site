<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoMax - Car Details</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Additional styles for car detail page */
        .car-detail-section {
            padding: 120px 0 80px;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .car-detail-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: start;
        }
        
        .car-detail-image {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            border-radius: 15px;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .car-detail-image i {
            font-size: 10rem;
            color: rgba(255, 255, 255, 0.2);
        }
        
        .car-detail-info {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .car-detail-header {
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        
        .car-detail-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .car-detail-price {
            font-size: 2rem;
            font-weight: bold;
            color: #2a5298;
            margin-bottom: 1rem;
        }
        
        .car-detail-description {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #666;
            margin-bottom: 2rem;
        }
        
        .car-specs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .car-spec-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .car-spec-item i {
            color: #2a5298;
            font-size: 1.2rem;
            min-width: 25px;
        }
        
        .car-features-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .car-feature {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .car-feature i {
            color: #2a5298;
        }
        
        .car-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .car-action-btn {
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #2a5298;
            color: white;
            border: none;
        }
        
        .btn-primary:hover {
            background: #1e3c72;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: transparent;
            color: #2a5298;
            border: 2px solid #2a5298;
        }
        
        .btn-secondary:hover {
            background: rgba(42, 82, 152, 0.1);
            transform: translateY(-2px);
        }
        
        .btn-favorite {
            background: transparent;
            color: #e74c3c;
            border: 2px solid #e74c3c;
        }
        
        .btn-favorite:hover {
            background: #e74c3c;
            color: white;
            transform: translateY(-2px);
        }
        
        .btn-favorite i {
            margin-right: 8px;
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 0.5rem;
        }
        
        .related-cars {
            padding: 80px 0;
            background: #f8f9fa;
        }
        
        .related-cars-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .car-detail-container {
                grid-template-columns: 1fr;
            }
            
            .car-specs {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <i class="fas fa-car"></i>
                <a href="index.html"><span>AutoMax</span></a>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html#home">Home</a></li>
                <li><a href="index.html#cars">Cars</a></li>
                <li><a href="index.html#about">About</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <!-- Car Detail Section -->
    <section class="car-detail-section">
        <div class="car-detail-container" id="carDetailContainer">
            <!-- Car details will be loaded here -->
        </div>
    </section>

    <!-- Related Cars Section -->
    <section class="related-cars">
        <div class="container">
            <h2 class="section-title">You May Also Like</h2>
            <div class="related-cars-grid" id="relatedCarsGrid">
                <!-- Related cars will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <i class="fas fa-car"></i>
                    <span>AutoMax</span>
                </div>
                <div class="footer-links">
                    <a href="index.html#home">Home</a>
                    <a href="index.html#cars">Cars</a>
                    <a href="index.html#about">About</a>
                    <a href="index.html#contact">Contact</a>
                </div>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 AutoMax. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Get car ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const carId = parseInt(urlParams.get('id'));
        
        // Car data (same as in script.js)
        const cars = [
            {
                id: 1,
                name: "BMW 3 Series",
                price: "$45,000",
                category: "sedan",
                year: "2023",
                fuel: "Gasoline",
                transmission: "Automatic",
                icon: "fas fa-car",
                description: "The BMW 3 Series combines luxury with performance, featuring advanced technology and exceptional driving dynamics.",
                features: ["Leather Seats", "Navigation System", "Backup Camera", "Bluetooth", "Sunroof"],
                engine: "2.0L Turbo 4-Cylinder",
                horsepower: "255 HP",
                mpg: "26 city / 36 highway",
                color: "Alpine White"
            },
            {
                id: 2,
                name: "Audi Q5",
                price: "$52,000",
                category: "suv",
                year: "2023",
                fuel: "Diesel",
                transmission: "Automatic",
                icon: "fas fa-car-side",
                description: "The Audi Q5 offers premium comfort and versatility with quattro all-wheel drive and cutting-edge technology.",
                features: ["Quattro AWD", "Virtual Cockpit", "Premium Sound", "Heated Seats", "Power Liftgate"],
                engine: "2.0L TFSI Quattro",
                horsepower: "261 HP",
                mpg: "23 city / 28 highway",
                color: "Glacier White"
            },
            {
                id: 3,
                name: "Mercedes C-Class",
                price: "$48,000",
                category: "sedan",
                year: "2023",
                fuel: "Hybrid",
                transmission: "Automatic",
                icon: "fas fa-car",
                description: "The Mercedes C-Class delivers elegance and innovation with hybrid efficiency and luxurious appointments.",
                features: ["MBUX Infotainment", "LED Headlights", "Wireless Charging", "Premium Interior", "Safety Assist"],
                engine: "2.0L Hybrid",
                horsepower: "255 HP",
                mpg: "28 city / 37 highway",
                color: "Obsidian Black"
            },
            {
                id: 4,
                name: "Volkswagen Golf",
                price: "$24,000",
                category: "hatchback",
                year: "2023",
                fuel: "Gasoline",
                transmission: "Manual",
                icon: "fas fa-car-alt",
                description: "The Volkswagen Golf is a compact car that offers excellent fuel economy and European engineering.",
                features: ["Digital Cockpit", "App-Connect", "Rear Camera", "Automatic Climate", "Sport Seats"],
                engine: "1.4L TSI",
                horsepower: "147 HP",
                mpg: "29 city / 39 highway",
                color: "Pure White"
            },
            {
                id: 5,
                name: "Toyota RAV4",
                price: "$35,000",
                category: "suv",
                year: "2023",
                fuel: "Hybrid",
                transmission: "Automatic",
                icon: "fas fa-car-side",
                description: "The Toyota RAV4 Hybrid combines fuel efficiency with rugged capability and Toyota's renowned reliability.",
                features: ["Toyota Safety 2.0", "All-Wheel Drive", "Entune 3.0", "Wireless Charging", "Power Tailgate"],
                engine: "2.5L Hybrid",
                horsepower: "219 HP",
                mpg: "41 city / 38 highway",
                color: "Magnetic Gray"
            },
            {
                id: 6,
                name: "Ford Focus",
                price: "$22,000",
                category: "hatchback",
                year: "2023",
                fuel: "Gasoline",
                transmission: "Manual",
                icon: "fas fa-car-alt",
                description: "The Ford Focus delivers sporty handling and modern technology in an affordable and efficient package.",
                features: ["SYNC 3", "FordPass Connect", "Rear Camera", "Automatic Headlights", "Cruise Control"],
                engine: "2.0L 4-Cylinder",
                horsepower: "160 HP",
                mpg: "27 city / 38 highway",
                color: "Race Red"
            },
            {
                id: 7,
                name: "Volvo XC90",
                price: "$65,000",
                category: "suv",
                year: "2023",
                fuel: "Hybrid",
                transmission: "Automatic",
                icon: "fas fa-car-side",
                description: "The Volvo XC90 represents Scandinavian luxury with advanced safety features and elegant design.",
                features: ["Pilot Assist", "Air Suspension", "Bowers & Wilkins Audio", "Panoramic Roof", "7 Seats"],
                engine: "2.0L Supercharged Hybrid",
                horsepower: "400 HP",
                mpg: "27 city / 29 highway",
                color: "Crystal White"
            },
            {
                id: 8,
                name: "Honda Civic",
                price: "$28,000",
                category: "sedan",
                year: "2023",
                fuel: "Gasoline",
                transmission: "Automatic",
                icon: "fas fa-car",
                description: "The Honda Civic offers reliability, fuel efficiency, and modern features in a stylish and practical sedan.",
                features: ["Honda Sensing", "Apple CarPlay", "Remote Start", "Heated Seats", "Dual-Zone Climate"],
                engine: "2.0L 4-Cylinder",
                horsepower: "158 HP",
                mpg: "31 city / 40 highway",
                color: "Sonic Gray"
            }
        ];
        
        // DOM Elements
        const carDetailContainer = document.getElementById('carDetailContainer');
        const relatedCarsGrid = document.getElementById('relatedCarsGrid');
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');
        
        // Mobile menu toggle
        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        });
        
        // Close mobile menu when clicking on a link
        document.querySelectorAll('.nav-menu a').forEach(link => {
            link.addEventListener('click', () => {
                hamburger.classList.remove('active');
                navMenu.classList.remove('active');
            });
        });
        
        // Load car details
        async function loadCarDetails() {
            let car = null;
            
            // Try to fetch from database first
            try {
                const response = await fetch(`/api/listings/${carId}`);
                if (response.ok) {
                    const dbCar = await response.json();
                    car = {
                        id: dbCar.id,
                        name: `${dbCar.make} ${dbCar.model}`,
                        price: `$${dbCar.price.toLocaleString()}`,
                        category: getCategoryFromMake(dbCar.make),
                        year: dbCar.year.toString(),
                        fuel: dbCar.fuelType,
                        transmission: dbCar.transmission,
                        icon: getIconFromMake(dbCar.make),
                        description: dbCar.description || 'No description available.',
                        features: ['Air Conditioning', 'Power Steering', 'ABS Brakes', 'Airbags'],
                        engine: '2.0L',
                        horsepower: '150 HP',
                        mpg: '25 MPG',
                        color: 'Black'
                    };
                } else {
                    // Fallback to static data
                    car = cars.find(c => c.id === carId);
                }
            } catch (error) {
                console.error('Error loading car from database:', error);
                // Fallback to static data
                car = cars.find(c => c.id === carId);
            }
            
            if (!car) {
                carDetailContainer.innerHTML = `
                    <div style="text-align: center; padding: 50px; grid-column: span 2;">
                        <h2>Car not found</h2>
                        <p>Sorry, the car you're looking for doesn't exist.</p>
                        <a href="index.html" class="car-action-btn btn-primary">Back to Home</a>
                    </div>
                `;
                return;
            }
            
            // Update page title
            document.title = `${car.name} - AutoMax`;
            
            // Create car detail HTML
            const carDetailHTML = `
                <div class="car-detail-image">
                    <i class="${car.icon}"></i>
                </div>
                <div class="car-detail-info">
                    <div class="car-detail-header">
                        <h1>${car.name}</h1>
                        <div class="car-detail-price">${car.price}</div>
                    </div>
                    
                    <p class="car-detail-description">${car.description}</p>
                    
                    <h3 class="section-title">Specifications</h3>
                    <div class="car-specs">
                        <div class="car-spec-item">
                            <i class="fas fa-calendar"></i>
                            <span><strong>Year:</strong> ${car.year}</span>
                        </div>
                        <div class="car-spec-item">
                            <i class="fas fa-gas-pump"></i>
                            <span><strong>Fuel:</strong> ${car.fuel}</span>
                        </div>
                        <div class="car-spec-item">
                            <i class="fas fa-cogs"></i>
                            <span><strong>Transmission:</strong> ${car.transmission}</span>
                        </div>
                        <div class="car-spec-item">
                            <i class="fas fa-palette"></i>
                            <span><strong>Color:</strong> ${car.color}</span>
                        </div>
                        <div class="car-spec-item">
                            <i class="fas fa-engine"></i>
                            <span><strong>Engine:</strong> ${car.engine}</span>
                        </div>
                        <div class="car-spec-item">
                            <i class="fas fa-tachometer-alt"></i>
                            <span><strong>Horsepower:</strong> ${car.horsepower}</span>
                        </div>
                        <div class="car-spec-item">
                            <i class="fas fa-road"></i>
                            <span><strong>MPG:</strong> ${car.mpg}</span>
                        </div>
                        <div class="car-spec-item">
                            <i class="fas fa-tag"></i>
                            <span><strong>Category:</strong> ${car.category.charAt(0).toUpperCase() + car.category.slice(1)}</span>
                        </div>
                    </div>
                    
                    <h3 class="section-title">Features</h3>
                    <div class="car-features-list">
                        ${car.features.map(feature => `
                            <div class="car-feature">
                                <i class="fas fa-check"></i>
                                <span>${feature}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="car-actions">
                        <button class="car-action-btn btn-primary" onclick="scheduleTestDrive(${car.id})">Schedule Test Drive</button>
                        <button class="car-action-btn btn-secondary" onclick="contactDealer(${car.id})">Contact Dealer</button>
                        <button class="car-action-btn btn-favorite" id="favoriteBtn" onclick="toggleFavorite(${car.id}, this)" style="display: none;">
                            <i class="far fa-heart"></i> Add to Favorites
                        </button>
                    </div>
                </div>
            `;
            
            carDetailContainer.innerHTML = carDetailHTML;
            
            // Show favorite button if user is logged in
            const token = localStorage.getItem('authToken');
            if (token) {
                const favoriteBtn = document.getElementById('favoriteBtn');
                if (favoriteBtn) {
                    favoriteBtn.style.display = 'inline-block';
                    // Check if car is already in favorites
                    checkFavoriteStatus(car.id, favoriteBtn);
                }
            }
            
            // Load related cars (same category)
            loadRelatedCars(car);
        }
        
        // Load related cars
        function loadRelatedCars(currentCar) {
            const relatedCars = cars.filter(car => 
                car.category === currentCar.category && car.id !== currentCar.id
            ).slice(0, 3); // Get up to 3 related cars
            
            if (relatedCars.length === 0) {
                document.querySelector('.related-cars').style.display = 'none';
                return;
            }
            
            relatedCarsGrid.innerHTML = relatedCars.map(car => `
                <div class="car-card">
                    <div class="car-image">
                        <i class="${car.icon}"></i>
                    </div>
                    <div class="car-info">
                        <h3>${car.name}</h3>
                        <div class="car-price">${car.price}</div>
                        <div class="car-features">
                            <span><i class="fas fa-calendar"></i> ${car.year}</span>
                            <span><i class="fas fa-gas-pump"></i> ${car.fuel}</span>
                            <span><i class="fas fa-cogs"></i> ${car.transmission}</span>
                        </div>
                        <button class="car-btn" onclick="goToCarDetail(${car.id})">View Details</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Schedule test drive
        function scheduleTestDrive(carId) {
            const car = cars.find(c => c.id === carId);
            alert(`Thank you for your interest in test driving the ${car.name}! Our team will contact you shortly to schedule your test drive.`);
        }
        
        // Contact dealer
        function contactDealer(carId) {
            const car = cars.find(c => c.id === carId);
            alert(`Thank you for your interest in the ${car.name}! Please call us at +90 212 555 0123 or visit our showroom for more information.`);
        }
        
        // Navigate to car detail
        function goToCarDetail(carId) {
            window.location.href = `car-detail.html?id=${carId}`;
        }
        
        // Helper function to get category from make
        function getCategoryFromMake(make) {
            const suvMakes = ['Audi', 'Toyota', 'Volvo'];
            const sedanMakes = ['BMW', 'Mercedes', 'Honda'];
            const hatchbackMakes = ['Volkswagen', 'Ford'];
            
            if (suvMakes.includes(make)) return 'suv';
            if (sedanMakes.includes(make)) return 'sedan';
            if (hatchbackMakes.includes(make)) return 'hatchback';
            return 'sedan'; // default
        }
        
        // Helper function to get icon from make
        function getIconFromMake(make) {
            const suvMakes = ['Audi', 'Toyota', 'Volvo'];
            const hatchbackMakes = ['Volkswagen', 'Ford'];
            
            if (suvMakes.includes(make)) return 'fas fa-car-side';
            if (hatchbackMakes.includes(make)) return 'fas fa-car-alt';
            return 'fas fa-car'; // default for sedans
        }
        
        // Check if car is in favorites
        async function checkFavoriteStatus(carId, button) {
            const token = localStorage.getItem('authToken');
            if (!token) return;
            
            try {
                const response = await fetch('/api/favorites', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const favorites = await response.json();
                    const isFavorited = favorites.some(fav => fav.id === carId);
                    
                    const icon = button.querySelector('i');
                    if (isFavorited) {
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                        button.innerHTML = '<i class="fas fa-heart"></i> Remove from Favorites';
                    } else {
                        icon.classList.remove('fas');
                        icon.classList.add('far');
                        button.innerHTML = '<i class="far fa-heart"></i> Add to Favorites';
                    }
                }
            } catch (error) {
                console.error('Error checking favorite status:', error);
            }
        }
        
        // Toggle favorite
        async function toggleFavorite(carId, button) {
            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please login to add favorites');
                return;
            }
            
            const icon = button.querySelector('i');
            const isFavorited = icon.classList.contains('fas');
            
            try {
                if (isFavorited) {
                    // Remove from favorites
                    const response = await fetch(`/api/favorites/${carId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        icon.classList.remove('fas');
                        icon.classList.add('far');
                        button.innerHTML = '<i class="far fa-heart"></i> Add to Favorites';
                    }
                } else {
                    // Add to favorites
                    const response = await fetch('/api/favorites', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ listingId: carId })
                    });
                    
                    if (response.ok) {
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                        button.innerHTML = '<i class="fas fa-heart"></i> Remove from Favorites';
                    } else if (response.status === 400) {
                        // Already in favorites
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                        button.innerHTML = '<i class="fas fa-heart"></i> Remove from Favorites';
                    }
                }
            } catch (error) {
                console.error('Error toggling favorite:', error);
                alert('Error updating favorites');
            }
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadCarDetails();
        });
    </script>
</body>
</html>